<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英文書寫體筆順教學網</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        h1 {
            color: #fff;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
        }

        .current-letter {
            font-size: 24px;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .keyboard-section {
            max-width: 600px;
            width: 100%;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            margin-bottom: 20px;
        }

        .keyboard-title {
            font-size: 14px;
            color: #888;
            margin-bottom: 12px;
            text-align: left;
            font-weight: 500;
        }

        .keyboard {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
        }

        button.key-btn {
            width: 38px;
            height: 38px;
            border: 2px solid #e0e0e0;
            background: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            color: #333;
            transition: all 0.2s ease;
            font-family: 'Georgia', serif;
        }

        button.key-btn:hover {
            background: #f0f4ff;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        button.key-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        svg#canvas {
            border: 1px solid #eee;
            border-radius: 12px;
            background-color: #fffdf5;
            display: block;
            margin: 0 auto;
        }

        .line-grid {
            stroke: #e8e8e8;
            stroke-width: 1;
        }

        .line-mid {
            stroke: #c8d8ff;
            stroke-width: 1.5;
            stroke-dasharray: 8, 4;
        }

        .line-base {
            stroke: #ffaaaa;
            stroke-width: 2.5;
        }

        .stroke-path {
            fill: none;
            stroke: #2c3e50;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .controls {
            margin-top: 18px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 24px;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .btn-replay {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .btn-replay:hover {
            background: linear-gradient(135deg, #f57c00, #e65100);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
        }

        .btn-speed {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
        }

        .btn-speed:hover {
            background: linear-gradient(135deg, #388E3C, #2E7D32);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .info-text {
            font-size: 13px;
            color: #888;
            margin-top: 15px;
        }

        .footer {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            margin-top: 20px;
            text-align: center;
        }

        .footer a {
            color: rgba(255, 255, 255, 0.9);
        }
    </style>
</head>

<body>

    <h1>✍️ 英文書寫體筆順練習</h1>

    <div class="card">
        <div class="current-letter" id="currentLetterDisplay">Letter: A</div>
        <svg width="550" height="400" viewBox="0 0 550 400" id="canvas">
            <!-- 四線格背景 -->
            <line x1="30" y1="100" x2="520" y2="100" class="line-grid" />
            <line x1="30" y1="180" x2="520" y2="180" class="line-mid" />
            <line x1="30" y1="260" x2="520" y2="260" class="line-base" />
            <line x1="30" y1="340" x2="520" y2="340" class="line-grid" />

            <g id="letter-container">
                <!-- 筆畫路徑會被 JS 插入這裡 -->
            </g>
        </svg>

        <div class="controls">
            <button class="btn btn-replay" onclick="replayAnimation()">
                <span>↺</span> 重播筆順
            </button>
            <button class="btn btn-speed" onclick="toggleSpeed()">
                <span>⏱</span> <span id="speedLabel">速度: 正常</span>
            </button>
        </div>
        <p class="info-text">點擊下方字母開始學習筆順 · 這是真正的 Cursive 草寫體</p>
    </div>

    <div class="keyboard-section">
        <div class="keyboard-title">大寫字母 (Uppercase Cursive)</div>
        <div class="keyboard" id="keyboard-upper"></div>
    </div>

    <div class="keyboard-section">
        <div class="keyboard-title">小寫字母 (Lowercase Cursive)</div>
        <div class="keyboard" id="keyboard-lower"></div>
    </div>

    <div class="footer">
        字體數據來源：Hershey Fonts - Script 1-stroke (Public Domain, 1967)<br>
        由 Dr. A.V. Hershey 於美國海軍武器實驗室開發
    </div>

    <script>
        // ============================================================
        // Hershey Script Font Data (Public Domain)
        // Source: "Script 1-stroke" from Hershey Fonts
        // Original work by Dr. A.V. Hershey, U.S. Naval Weapons Laboratory, 1967
        // ============================================================

        const cursiveFontData = {
            // === 大寫字母 ===
            'A': {
                path: "M0,22 L2,21 5,18 8,14 12,7 15,1 15,22 14,19 12,16 10,14 7,12 5,12 4,13 4,15 5,17 7,19 10,21 13,22 18,22",
                width: 9
            },
            'B': {
                path: "M13,3 L14,4 14,7 13,11 12,14 11,16 9,19 7,21 5,22 4,22 3,21 3,18 4,13 5,10 6,8 8,5 10,3 12,2 15,1 18,1 20,2 21,4 21,6 20,8 19,9 17,10 14,11 M13,11 L14,11 17,12 18,13 19,15 19,18 18,20 17,21 15,22 12,22 10,21 9,19",
                width: 11
            },
            'C': {
                path: "M12,7 L12,8 13,9 15,9 17,8 18,6 18,4 17,2 15,1 12,1 9,2 7,4 5,7 4,9 3,13 3,17 4,20 5,21 7,22 9,22 12,21 14,19 15,17",
                width: 10
            },
            'D': {
                path: "M13,1 L11,2 10,4 9,8 8,14 7,17 6,19 4,21 2,22 0,22 -1,21 -1,19 0,18 2,18 4,19 6,21 9,22 12,22 15,21 17,19 19,15 20,10 20,6 19,3 18,2 16,1 13,1 11,3 11,5 12,8 14,11 16,13 19,15 21,16",
                width: 12
            },
            'E': {
                path: "M14,5 L14,6 15,7 17,7 18,6 18,4 17,2 14,1 10,1 7,2 6,4 6,7 7,9 8,10 11,11 8,11 5,12 4,13 3,15 3,18 4,20 5,21 8,22 11,22 14,21 16,19 17,17",
                width: 10
            },
            'F': {
                path: "M10,7 L8,7 6,6 5,4 6,2 9,1 12,1 16,2 19,2 21,1 M16,2 L14,9 12,15 10,19 8,21 6,22 4,22 2,21 1,19 1,17 2,16 4,16 6,17 M9,11 L18,11",
                width: 10
            },
            'G': {
                path: "M0,22 L2,21 6,17 9,12 10,9 11,5 11,2 10,1 9,1 8,2 7,4 7,7 8,9 10,10 14,10 17,9 18,8 19,6 19,12 18,17 17,19 15,21 12,22 8,22 5,21 3,19 2,17 2,15",
                width: 12
            },
            'H': {
                path: "M7,8 L5,7 4,5 4,4 5,2 7,1 8,1 10,2 11,4 11,6 10,10 8,16 6,20 4,22 2,22 1,21 1,19 M7,13 L16,10 18,9 21,7 23,5 24,3 24,2 23,1 22,1 20,3 18,7 16,13 15,18 15,21 16,22 17,22 19,21 20,20 22,17",
                width: 12
            },
            'I': {
                path: "M14,17 L12,15 10,12 9,10 8,7 8,4 9,2 10,1 12,1 13,2 14,4 14,7 13,12 11,17 10,19 8,21 6,22 4,22 2,21 1,19 1,17 2,16 4,16 6,17",
                width: 8
            },
            'J': {
                path: "M10,25 L8,22 6,17 5,11 5,5 6,2 8,1 10,1 11,2 12,5 12,8 11,13 8,22 6,28 5,31 4,33 2,34 1,33 1,31 2,28 4,25 6,23 9,21 13,19",
                width: 7
            },
            'K': {
                path: "M7,8 L5,7 4,5 4,4 5,2 7,1 8,1 10,2 11,4 11,6 10,10 8,16 6,20 4,22 2,22 1,21 1,19 M24,4 L24,2 23,1 22,1 20,2 18,4 16,7 14,9 12,10 10,10 M12,10 L13,12 13,19 14,21 15,22 16,22 18,21 19,20 21,17",
                width: 12
            },
            'L': {
                path: "M4,13 L6,13 10,12 13,10 15,8 16,6 16,3 15,1 13,1 12,2 11,4 10,9 9,14 8,17 7,19 5,21 3,22 1,22 0,21 0,19 1,18 3,18 5,19 8,21 11,22 13,22 16,21 18,19",
                width: 10
            },
            'M': {
                path: "M5,8 L3,7 2,5 2,4 3,2 5,1 6,1 8,2 9,4 9,6 8,11 7,15 5,22 M7,15 L10,7 12,3 13,2 15,1 16,1 18,2 19,4 19,6 18,11 17,15 15,22 M17,15 L20,7 22,3 23,2 25,1 26,1 28,2 29,4 29,6 28,11 26,18 26,21 27,22 28,22 30,21 31,20 33,17",
                width: 15
            },
            'N': {
                path: "M5,8 L3,7 2,5 2,4 3,2 5,1 6,1 8,2 9,4 9,6 8,11 7,15 5,22 M7,15 L10,7 12,3 13,2 15,1 17,1 19,2 20,4 20,6 19,11 17,18 17,21 18,22 19,22 21,21 22,20 24,17",
                width: 11
            },
            'O': {
                path: "M12,1 L9,2 7,4 5,7 4,9 3,13 3,17 4,20 5,21 7,22 9,22 12,21 14,19 16,16 17,14 18,10 18,6 17,3 16,2 14,1 12,1 10,3 10,6 11,9 13,12 15,14 18,16 20,17",
                width: 11
            },
            'P': {
                path: "M13,3 L14,4 14,7 13,11 12,14 11,16 9,19 7,21 5,22 4,22 3,21 3,18 4,13 5,10 6,8 8,5 10,3 12,2 15,1 20,1 22,2 23,3 24,5 24,8 23,10 22,11 20,12 17,12 15,11 14,10",
                width: 13
            },
            'Q': {
                path: "M13,7 L12,9 11,10 9,11 7,11 6,9 6,7 7,4 9,2 12,1 15,1 17,2 18,4 18,8 17,11 15,14 11,18 8,20 6,21 3,22 1,22 0,21 0,19 1,18 3,18 5,19 8,21 11,22 14,22 17,21 19,19",
                width: 12
            },
            'R': {
                path: "M13,3 L14,4 14,7 13,11 12,14 11,16 9,19 7,21 5,22 4,22 3,21 3,18 4,13 5,10 6,8 8,5 10,3 12,2 15,1 19,1 21,2 22,3 23,5 23,8 22,10 21,11 19,12 16,12 13,11 14,12 15,14 15,19 16,21 18,22 20,21 21,20 23,17",
                width: 13
            },
            'S': {
                path: "M0,22 L2,21 4,19 7,15 9,12 11,8 12,5 12,2 11,1 10,1 9,2 8,4 8,6 9,8 11,10 14,12 16,14 17,16 17,18 16,20 15,21 12,22 8,22 5,21 3,19 2,17 2,15",
                width: 10
            },
            'T': {
                path: "M10,7 L8,7 6,6 5,4 6,2 9,1 12,1 16,2 19,2 21,1 M16,2 L14,9 12,15 10,19 8,21 6,22 4,22 2,21 1,19 1,17 2,16 4,16 6,17",
                width: 9
            },
            'U': {
                path: "M5,8 L3,7 2,5 2,4 3,2 5,1 6,1 8,2 9,4 9,6 8,10 7,13 6,17 6,19 7,21 9,22 11,22 13,21 14,20 16,16 19,8 21,1 M19,8 L18,12 17,18 17,21 18,22 19,22 21,21 22,20 24,17",
                width: 11
            },
            'V': {
                path: "M5,8 L3,7 2,5 2,4 3,2 5,1 6,1 8,2 9,4 9,6 8,10 7,13 6,17 6,20 7,22 9,22 11,21 14,18 16,15 18,11 19,8 20,4 20,2 19,1 18,1 17,2 16,4 16,6 17,9 19,11 21,12",
                width: 11
            },
            'W': {
                path: "M5,8 L3,7 2,5 2,4 3,2 5,1 6,1 8,2 9,4 9,7 8,22 M18,1 L8,22 M18,1 L16,22 M30,1 L28,2 25,5 22,9 19,15 16,22",
                width: 13
            },
            'X': {
                path: "M8,7 L6,7 5,6 5,4 6,2 8,1 10,1 12,2 13,4 13,7 11,16 11,19 12,21 14,22 16,22 18,21 19,19 19,17 18,16 16,16 M23,4 L23,2 22,1 20,1 18,2 16,4 14,7 10,16 8,19 6,21 4,22 2,22 1,21 1,19",
                width: 12
            },
            'Y': {
                path: "M5,8 L3,7 2,5 2,4 3,2 5,1 6,1 8,2 9,4 9,6 8,10 7,13 6,17 6,19 7,21 8,22 10,22 12,21 14,19 16,16 17,14 19,8 M21,1 L19,8 16,18 14,24 12,29 10,33 8,34 7,33 7,31 8,28 10,25 13,22 16,20 21,17",
                width: 11
            },
            'Z': {
                path: "M13,7 L12,9 11,10 9,11 7,11 6,9 6,7 7,4 9,2 12,1 15,1 17,2 18,4 18,8 17,11 15,15 12,18 8,21 6,22 3,22 2,21 2,19 3,18 6,18 8,19 9,20 10,22 10,25 9,28 8,30 6,33 4,34 3,33 3,31 4,28 6,25 9,22 12,20 18,17",
                width: 11
            },

            // === 小寫字母 ===
            'a': {
                path: "M9,16 L8,14 6,13 4,13 2,14 1,15 0,17 0,19 1,21 3,22 5,22 7,21 8,19 10,13 9,18 9,21 10,22 11,22 13,21 14,20 16,17",
                width: 10
            },
            'b': {
                path: "M0,17 L2,14 5,9 6,7 7,4 7,2 6,1 4,2 3,4 2,8 1,15 1,21 2,22 3,22 5,21 7,19 8,16 8,13 9,17 10,18 12,18 14,17",
                width: 9
            },
            'c': {
                path: "M7,15 L7,14 6,13 4,13 2,14 1,15 0,17 0,19 1,21 3,22 6,22 9,20 11,17",
                width: 6
            },
            'd': {
                path: "M9,16 L8,14 6,13 4,13 2,14 1,15 0,17 0,19 1,21 3,22 5,22 7,21 8,19 14,1 M10,13 L9,18 9,21 10,22 11,22 13,21 14,20 16,17",
                width: 10
            },
            'e': {
                path: "M1,20 L3,19 4,18 5,16 5,14 4,13 3,13 1,14 0,16 0,19 1,21 3,22 5,22 7,21 8,20 10,17",
                width: 6
            },
            'f': {
                path: "M0,17 L4,12 6,9 7,7 8,4 8,2 7,1 5,2 4,4 2,12 -1,21 -4,28 -5,31 -5,33 -4,34 -2,33 -1,30 0,21 1,22 3,22 5,21 6,20 8,17",
                width: 5
            },
            'g': {
                path: "M9,16 L8,14 6,13 4,13 2,14 1,15 0,17 0,19 1,21 3,22 5,22 7,21 8,20 M10,13 L8,20 4,31 3,33 1,34 0,33 0,31 1,28 4,25 7,23 9,22 12,20 15,17",
                width: 9
            },
            'h': {
                path: "M0,17 L2,14 5,9 6,7 7,4 7,2 6,1 4,2 3,4 2,8 1,14 0,22 M0,22 L1,19 2,17 4,14 6,13 8,13 9,14 9,16 8,19 8,21 9,22 10,22 12,21 13,20 15,17",
                width: 10
            },
            'i': {
                path: "M3,8 L3,9 4,9 4,8 3,8 M0,17 L2,13 0,19 0,21 1,22 2,22 4,21 5,20 7,17",
                width: 5
            },
            'j': {
                path: "M3,8 L3,9 4,9 4,8 3,8 M0,17 L2,13 -4,31 -5,33 -7,34 -8,33 -8,31 -7,28 -4,25 -1,23 1,22 4,20 7,17",
                width: 5
            },
            'k': {
                path: "M0,17 L2,14 5,9 6,7 7,4 7,2 6,1 4,2 3,4 2,8 1,14 0,22 M0,22 L1,19 2,17 4,14 6,13 8,13 9,14 9,16 7,17 4,17 M4,17 L6,18 7,21 8,22 9,22 11,21 12,20 14,17",
                width: 9
            },
            'l': {
                path: "M0,17 L2,14 5,9 6,7 7,4 7,2 6,1 4,2 3,4 2,8 1,15 1,21 2,22 3,22 5,21 6,20 8,17",
                width: 5
            },
            'm': {
                path: "M0,17 L2,14 4,13 5,14 5,15 4,19 3,22 M4,19 L5,17 7,14 9,13 11,13 12,14 12,15 11,19 10,22 M11,19 L12,17 14,14 16,13 18,13 19,14 19,16 18,19 18,21 19,22 20,22 22,21 23,20 25,17",
                width: 12
            },
            'n': {
                path: "M0,17 L2,14 4,13 5,14 5,15 4,19 3,22 M4,19 L5,17 7,14 9,13 11,13 12,14 12,16 11,19 11,21 12,22 13,22 15,21 16,20 18,17",
                width: 10
            },
            'o': {
                path: "M6,13 L4,13 2,14 1,15 0,17 0,19 1,21 3,22 5,22 7,21 8,20 9,18 9,16 8,14 6,13 5,14 5,16 6,18 8,19 11,19 13,18 14,17",
                width: 8
            },
            'p': {
                path: "M0,17 L2,14 3,12 2,16 -4,34 M2,16 L3,14 5,13 7,13 9,14 10,16 10,18 9,20 8,21 6,22 M2,21 L4,22 7,22 10,21 12,20 15,17",
                width: 8
            },
            'q': {
                path: "M9,16 L8,14 6,13 4,13 2,14 1,15 0,17 0,19 1,21 3,22 5,22 7,21 M10,13 L9,16 7,21 4,28 3,31 3,33 4,34 6,33 7,30 7,23 9,22 12,20 15,17",
                width: 9
            },
            'r': {
                path: "M0,17 L2,14 3,12 3,14 6,14 7,15 7,17 6,20 6,21 7,22 8,22 10,21 11,20 13,17",
                width: 8
            },
            's': {
                path: "M0,17 L2,14 3,12 3,14 5,17 6,19 6,21 4,22 M0,21 L2,22 6,22 8,21 9,20 11,17",
                width: 7
            },
            't': {
                path: "M0,17 L2,14 4,10 M7,1 L1,19 1,21 2,22 4,22 6,21 7,20 9,17 M1,9 L8,9",
                width: 6
            },
            'u': {
                path: "M0,17 L2,13 0,19 0,21 1,22 3,22 5,21 7,19 9,16 M10,13 L8,19 8,21 9,22 10,22 12,21 13,20 15,17",
                width: 9
            },
            'v': {
                path: "M0,17 L2,13 1,18 1,21 2,22 3,22 6,21 8,19 9,16 9,13 M9,13 L10,17 11,18 13,18 15,17",
                width: 9
            },
            'w': {
                path: "M3,13 L1,15 0,18 0,20 1,22 3,22 5,21 7,19 M9,13 L7,19 7,21 8,22 10,22 12,21 14,19 15,16 15,13 M15,13 L16,17 17,18 19,18 21,17",
                width: 12
            },
            'x': {
                path: "M0,17 L2,14 4,13 6,13 7,14 7,21 8,22 11,22 14,20 16,17 M13,14 L12,13 10,13 9,14 5,21 4,22 2,22 1,21",
                width: 8
            },
            'y': {
                path: "M0,17 L2,13 0,19 0,21 1,22 3,22 5,21 7,19 9,16 M10,13 L4,31 3,33 1,34 0,33 0,31 1,28 4,25 7,23 9,22 12,20 15,17",
                width: 9
            },
            'z': {
                path: "M0,17 L2,14 4,13 6,13 8,15 8,17 7,19 5,21 2,22 4,23 5,25 5,28 4,31 3,33 1,34 0,33 0,31 1,28 4,25 7,23 11,20 14,17",
                width: 8
            },
        };

        // 全域變數
        let currentLetter = 'A';
        let animationSpeed = 1;
        let speedIndex = 0;
        const speeds = [
            { value: 1, label: '正常' },
            { value: 0.5, label: '慢速' },
            { value: 2, label: '快速' }
        ];

        // 初始化
        window.onload = function () {
            createKeyboard();
            loadLetter('A');
        };

        // 建立鍵盤按鈕
        function createKeyboard() {
            const upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            const lower = "abcdefghijklmnopqrstuvwxyz";

            const upperContainer = document.getElementById('keyboard-upper');
            const lowerContainer = document.getElementById('keyboard-lower');

            upper.split('').forEach(char => {
                upperContainer.appendChild(createBtn(char));
            });

            lower.split('').forEach(char => {
                lowerContainer.appendChild(createBtn(char));
            });
        }

        function createBtn(char) {
            const btn = document.createElement('button');
            btn.innerText = char;
            btn.className = 'key-btn';
            btn.onclick = () => loadLetter(char);
            return btn;
        }

        // 解析 Hershey 路徑成 SVG 路徑
        function hersheyToSVG(hersheyPath) {
            // Hershey 格式：使用字母來表示座標 (每個字母 = ASCII - 82)
            // M = 移動到, L = 畫線到, 空格 = 抬筆
            let svgPath = '';
            const coords = hersheyPath.trim().split(' ');

            for (let i = 0; i < coords.length; i++) {
                const coord = coords[i];
                if (coord.length === 0) continue;

                // 第一個字符是命令 (M 或 L)
                const command = coord[0];
                const rest = coord.substring(1);

                // 解析座標對
                const pairs = [];
                for (let j = 0; j < rest.length; j += 2) {
                    if (j + 1 < rest.length) {
                        const x = rest.charCodeAt(j) - 82;
                        const y = rest.charCodeAt(j + 1) - 82;
                        pairs.push([x, y]);
                    }
                }

                // 轉換成 SVG 命令
                pairs.forEach((pair, idx) => {
                    const [x, y] = pair;
                    if (idx === 0) {
                        svgPath += `${command}${x},${y} `;
                    } else {
                        svgPath += `L${x},${y} `;
                    }
                });
            }

            return svgPath.trim();
        }

        // 將路徑按 M 命令拆分成多個筆畫
        function splitPathIntoStrokes(pathData) {
            const strokes = [];
            const parts = pathData.split(/(?=M)/); // 在每個 M 之前分割

            parts.forEach(part => {
                if (part.trim()) {
                    strokes.push(part.trim());
                }
            });

            return strokes;
        }

        // 載入字母
        function loadLetter(char) {
            currentLetter = char;

            document.getElementById('currentLetterDisplay').innerText = `Letter: ${char}`;

            document.querySelectorAll('.key-btn').forEach(b => b.classList.remove('active'));
            Array.from(document.querySelectorAll('.key-btn'))
                .filter(b => b.innerText === char)
                .forEach(b => b.classList.add('active'));

            const charData = cursiveFontData[char];
            const container = document.getElementById('letter-container');
            container.innerHTML = '';

            if (charData && charData.path) {
                // 將路徑拆分成多個筆畫
                const strokes = splitPathIntoStrokes(charData.path);

                // 縮放和位置參數
                const scale = 8;
                const offsetX = 275 - (charData.width * scale / 2);
                const offsetY = 100;

                // 為每個筆畫創建獨立的 path 元素
                strokes.forEach((strokePath, index) => {
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    path.setAttribute("d", strokePath);
                    path.setAttribute("class", "stroke-path");
                    path.setAttribute("transform", `translate(${offsetX}, ${offsetY}) scale(${scale}, ${scale})`);
                    path.style.opacity = '0'; // 初始隱藏
                    container.appendChild(path);
                });

                // 依序播放每個筆畫的動畫
                const paths = container.querySelectorAll('.stroke-path');
                animatePathsSequentially(paths, 0);
            }
        }

        // 依序動畫每個筆畫
        function animatePathsSequentially(paths, index) {
            if (index >= paths.length) return;

            const path = paths[index];
            path.style.opacity = '1'; // 顯示當前筆畫

            const length = path.getTotalLength();
            path.style.strokeDasharray = length;
            path.style.strokeDashoffset = length;
            path.getBoundingClientRect();

            const baseDuration = length / 150;
            const duration = Math.max(0.5, baseDuration) / animationSpeed;

            path.style.transition = `stroke-dashoffset ${duration}s ease-in-out`;
            path.style.strokeDashoffset = '0';

            // 當前筆畫完成後，播放下一個筆畫
            setTimeout(() => {
                animatePathsSequentially(paths, index + 1);
            }, duration * 1000 + 150); // 150ms 間隔讓筆順更清晰
        }

        // 動畫函式
        function animatePath(path) {
            const length = path.getTotalLength();
            path.style.strokeDasharray = length;
            path.style.strokeDashoffset = length;
            path.getBoundingClientRect();

            const baseDuration = length / 150;
            const duration = Math.max(0.5, baseDuration) / animationSpeed;

            path.style.transition = `stroke-dashoffset ${duration}s ease-in-out`;
            path.style.strokeDashoffset = '0';
        }

        // 重播
        function replayAnimation() {
            loadLetter(currentLetter);
        }

        // 切換速度
        function toggleSpeed() {
            speedIndex = (speedIndex + 1) % speeds.length;
            animationSpeed = speeds[speedIndex].value;
            document.getElementById('speedLabel').innerText = `速度: ${speeds[speedIndex].label}`;
        }
    </script>
</body>

</html>